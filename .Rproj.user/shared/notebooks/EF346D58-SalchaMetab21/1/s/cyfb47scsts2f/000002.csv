"0","Salcha.exo.2021 <- read.csv(file=file.path(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/Salcha/EXO_data/from_internal_harddrive/processed/SALCHA.EXO.aord.csv""))"
"0",""
"0","ts_2021 <- read.csv(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/Metabolism-UAF/ts_2021.csv"")"
"0",""
"0","# setwd(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/Salcha/EXO_data/from_internal_harddrive/"")"
"0",""
"0","test <- full_join(ts_2021, Salcha.exo.2021, by = ""datetimeAK"")"
"0",""
"0","write.csv(test, ""C:/Users/jacob/OneDrive - University of Alaska/GitHub/Metabolism-UAF/salcha.2021.full.ts.csv"")"
"0",""
"0","setwd(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/"")"
"0",""
"0","EXO.list <- list.files(path=""Metabolism-UAF"", "
"0","                       recursive=F, "
"0","                       pattern=""salcha.2021.full.ts.csv"", "
"0","                       full.names=TRUE)"
"0",""
"0","EXO.cl <- lapply(EXO.list, "
"0","                 read.csv, "
"0","                 stringsAsFactors=FALSE, "
"0","                 header = TRUE)"
"0",""
"0",""
"0","setwd(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/"")"
"0",""
"0",""
"0","# Format datetime"
"0","EXO.cl <- lapply(EXO.cl, function(x) {"
"0","  mutate(x, datetimeAK = as.POSIXct(datetimeAK, format = ""%Y-%m-%d %H:%M:%S"", tz= ""America/Anchorage""))"
"0","})"
"0",""
"0",""
"0","### Fill gaps in Turbidity ###"
"0","anyNA(EXO.cl, recursive = TRUE)"
"1","[1]"
"1"," TRUE"
"1","
"
"0","lapply(EXO.cl, summary)"
"1","[[1]]
"
"1",""
"1","       X        "
"1","      X.x       "
"1","   datetimeAK                 "
"1","
"
"1"," Min.   :    1  "
"1"," Min.   :    1  "
"1"," Min.   :2021-05-18 12:00:00  "
"1","
"
"1"," 1st Qu.: 3247  "
"1"," 1st Qu.: 3244  "
"1"," 1st Qu.:2021-06-21 07:26:15  "
"1","
"
"1"," Median : 6492  "
"1"," Median : 6486  "
"1"," Median :2021-07-25 02:52:30  "
"1","
"
"1"," Mean   : 6492  "
"1"," Mean   : 6486  "
"1"," Mean   :2021-07-25 02:52:30  "
"1","
"
"1"," 3rd Qu.: 9738  "
"1"," 3rd Qu.: 9728  "
"1"," 3rd Qu.:2021-08-27 22:18:45  "
"1","
"
"1"," Max.   :12984  "
"1"," Max.   :12971  "
"1"," Max.   :2021-09-30 17:45:00  "
"1","
"
"1","                "
"1"," NA's   :13     "
"1","                              "
"1","
"
"1",""
"1","      X.y       "
"1","     min           "
"1","  fDOM.QSU.mn   "
"1","  fDOM.QSU.SD     "
"1","
"
"1"," Min.   :    1  "
"1"," Length:12984      "
"1"," Min.   :22.05  "
"1"," Min.   :0.00302  "
"1","
"
"1"," 1st Qu.: 3233  "
"1"," Class :character  "
"1"," 1st Qu.:27.09  "
"1"," 1st Qu.:0.01250  "
"1","
"
"1"," Median : 6465  "
"1"," Mode  :character  "
"1"," Median :33.73  "
"1"," Median :0.01916  "
"1","
"
"1"," Mean   : 6465  "
"1","                   "
"1"," Mean   :37.40  "
"1"," Mean   :0.02324  "
"1","
"
"1"," 3rd Qu.: 9697  "
"1","                   "
"1"," 3rd Qu.:44.33  "
"1"," 3rd Qu.:0.02832  "
"1","
"
"1"," Max.   :12929  "
"1","                   "
"1"," Max.   :97.89  "
"1"," Max.   :1.45557  "
"1","
"
"1"," NA's   :55     "
"1","                   "
"1"," NA's   :114    "
"1"," NA's   :55       "
"1","
"
"1",""
"1","  ODO.Psat.mn    "
"1","  ODO.Psat.SD     "
"1","  ODO.Ploc.mn    "
"1","  ODO.Ploc.SD     "
"1","
"
"1"," Min.   : 88.40  "
"1"," Min.   :0.00000  "
"1"," Min.   : 89.10  "
"1"," Min.   :0.00000  "
"1","
"
"1"," 1st Qu.: 94.27  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.: 96.63  "
"1"," 1st Qu.:0.00000  "
"1","
"
"1"," Median : 96.36  "
"1"," Median :0.00000  "
"1"," Median : 98.90  "
"1"," Median :0.00000  "
"1","
"
"1"," Mean   : 96.77  "
"1"," Mean   :0.01611  "
"1"," Mean   : 99.12  "
"1"," Mean   :0.01655  "
"1","
"
"1"," 3rd Qu.: 99.28  "
"1"," 3rd Qu.:0.04045  "
"1"," 3rd Qu.:101.90  "
"1"," 3rd Qu.:0.04045  "
"1","
"
"1"," Max.   :106.40  "
"1"," Max.   :0.07862  "
"1"," Max.   :109.30  "
"1"," Max.   :0.08739  "
"1","
"
"1"," NA's   :55      "
"1"," NA's   :55       "
"1"," NA's   :56      "
"1"," NA's   :55       "
"1","
"
"1",""
"1","   ODO.mgL.mn   "
"1","   ODO.mgL.SD     "
"1"," SpCond.uScm.mn "
"1"," SpCond.uScm.SD   "
"1","
"
"1"," Min.   : 8.89  "
"1"," Min.   :0.00000  "
"1"," Min.   :126.6  "
"1"," Min.   :0.00000  "
"1","
"
"1"," 1st Qu.:10.03  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:203.0  "
"1"," 1st Qu.:0.04671  "
"1","
"
"1"," Median :10.46  "
"1"," Median :0.00000  "
"1"," Median :220.3  "
"1"," Median :0.05045  "
"1","
"
"1"," Mean   :10.80  "
"1"," Mean   :0.00190  "
"1"," Mean   :209.8  "
"1"," Mean   :0.05257  "
"1","
"
"1"," 3rd Qu.:11.43  "
"1"," 3rd Qu.:0.00467  "
"1"," 3rd Qu.:229.3  "
"1"," 3rd Qu.:0.05222  "
"1","
"
"1"," Max.   :14.14  "
"1"," Max.   :0.01044  "
"1"," Max.   :251.8  "
"1"," Max.   :0.42916  "
"1","
"
"1"," NA's   :56     "
"1"," NA's   :55       "
"1"," NA's   :61     "
"1"," NA's   :55       "
"1","
"
"1",""
"1"," Turbidity.FNU.mn  "
"1"," Turbidity.FNU.SD   "
"1","   Temp.C.mn     "
"1","
"
"1"," Min.   :-1.85000  "
"1"," Min.   :  0.00405  "
"1"," Min.   :-0.015  "
"1","
"
"1"," 1st Qu.:-1.04364  "
"1"," 1st Qu.:  0.02292  "
"1"," 1st Qu.: 7.890  "
"1","
"
"1"," Median :-0.52091  "
"1"," Median :  0.04228  "
"1"," Median :10.441  "
"1","
"
"1"," Mean   : 0.07139  "
"1"," Mean   :  0.16304  "
"1"," Mean   :10.700  "
"1","
"
"1"," 3rd Qu.: 0.81182  "
"1"," 3rd Qu.:  0.08755  "
"1"," 3rd Qu.:14.341  "
"1","
"
"1"," Max.   :16.44182  "
"1"," Max.   :260.90165  "
"1"," Max.   :18.458  "
"1","
"
"1"," NA's   :276       "
"1"," NA's   :55         "
"1"," NA's   :406     "
"1","
"
"1",""
"1","   Temp.C.SD      "
"1","     pH.mn      "
"1","     pH.SD        "
"1","  Battery.V.mn  "
"1","
"
"1"," Min.   :0.00000  "
"1"," Min.   :7.260  "
"1"," Min.   :0.00000  "
"1"," Min.   :4.675  "
"1","
"
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:7.540  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:5.357  "
"1","
"
"1"," Median :0.00040  "
"1"," Median :7.600  "
"1"," Median :0.00000  "
"1"," Median :5.551  "
"1","
"
"1"," Mean   :0.00052  "
"1"," Mean   :7.585  "
"1"," Mean   :0.00080  "
"1"," Mean   :5.541  "
"1","
"
"1"," 3rd Qu.:0.00052  "
"1"," 3rd Qu.:7.650  "
"1"," 3rd Qu.:0.00000  "
"1"," 3rd Qu.:5.758  "
"1","
"
"1"," Max.   :0.01811  "
"1"," Max.   :7.800  "
"1"," Max.   :0.00527  "
"1"," Max.   :6.244  "
"1","
"
"1"," NA's   :55       "
"1"," NA's   :1857   "
"1"," NA's   :55       "
"1"," NA's   :55     "
"1","
"
"1",""
"1","  Battery.V.SD    "
"1"," CablePwr.V.mn"
"1"," CablePwr.V.SD"
"1","
"
"1"," Min.   :0.00000  "
"1"," Min.   :0    "
"1"," Min.   :0    "
"1","
"
"1"," 1st Qu.:0.00302  "
"1"," 1st Qu.:0    "
"1"," 1st Qu.:0    "
"1","
"
"1"," Median :0.00467  "
"1"," Median :0    "
"1"," Median :0    "
"1","
"
"1"," Mean   :0.00482  "
"1"," Mean   :0    "
"1"," Mean   :0    "
"1","
"
"1"," 3rd Qu.:0.00522  "
"1"," 3rd Qu.:0    "
"1"," 3rd Qu.:0    "
"1","
"
"1"," Max.   :0.06332  "
"1"," Max.   :0    "
"1"," Max.   :0    "
"1","
"
"1"," NA's   :55       "
"1"," NA's   :55   "
"1"," NA's   :55   "
"1","
"
"1","
"
"0","# Make univariate time series, covert to zoo, then to ts #"
"0","turb.only <- lapply(EXO.cl, '[', (c(""datetimeAK"", ""Turbidity.FNU.mn"")))"
"0",""
"0","turb.ts <- lapply(turb.only, function(x) {read.zoo(x, index.column=1, format=""%Y-%m-%d %H:%M:%S"", tz=""America/Anchorage"")"
"0","})"
"0",""
"0","turb.xts <- lapply(turb.ts, function(x) {as.xts(x)"
"0","})"
"0",""
"0","# Apply auto.arima (default model in call to na_kalman) and kalman filter (default = smooth) to impute missing values using na.kalman from imputeTS #"
"0","turb.int <- lapply(turb.xts, function(x) {na_kalman(x)"
"0","})"
"0",""
"0","anyNA(turb.int, recursive = TRUE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","# revert xts to dataframe"
"0","turb.ma.int = lapply(turb.int, function(x) {data.frame(datetimeAK=time(x), turb.ma.int=as.matrix(x))"
"0","})"
"0",""
"0","turb.ma.int <- lapply(turb.ma.int, setNames, c(""datetimeAK"", ""Turb.FNU.ma.int""))"
"0",""
"0","# Rejoin to instrument record (EXO.cl)"
"0","EXO.cl.int <- map2(EXO.cl, turb.ma.int, ~merge(.x, .y, by = ""datetimeAK""))"
"0",""
"0","## Compare instrument record and with imputed turbidity time series"
"0","# to dataframe for compatibility with ggplot"
"0","EXO.cl.int.df <- bind_rows(EXO.cl.int, .id = ""Site"")"
"0",""
"0",""
"0","### Fill gaps in Temperature ###"
"0","anyNA(EXO.cl, recursive = TRUE)"
"1","[1]"
"1"," TRUE"
"1","
"
"0","lapply(EXO.cl, summary)"
"1","[[1]]
"
"1",""
"1","       X        "
"1","      X.x       "
"1","   datetimeAK                 "
"1","
"
"1"," Min.   :    1  "
"1"," Min.   :    1  "
"1"," Min.   :2021-05-18 12:00:00  "
"1","
"
"1"," 1st Qu.: 3247  "
"1"," 1st Qu.: 3244  "
"1"," 1st Qu.:2021-06-21 07:26:15  "
"1","
"
"1"," Median : 6492  "
"1"," Median : 6486  "
"1"," Median :2021-07-25 02:52:30  "
"1","
"
"1"," Mean   : 6492  "
"1"," Mean   : 6486  "
"1"," Mean   :2021-07-25 02:52:30  "
"1","
"
"1"," 3rd Qu.: 9738  "
"1"," 3rd Qu.: 9728  "
"1"," 3rd Qu.:2021-08-27 22:18:45  "
"1","
"
"1"," Max.   :12984  "
"1"," Max.   :12971  "
"1"," Max.   :2021-09-30 17:45:00  "
"1","
"
"1","                "
"1"," NA's   :13     "
"1","                              "
"1","
"
"1",""
"1","      X.y       "
"1","     min           "
"1","  fDOM.QSU.mn   "
"1","  fDOM.QSU.SD     "
"1","
"
"1"," Min.   :    1  "
"1"," Length:12984      "
"1"," Min.   :22.05  "
"1"," Min.   :0.00302  "
"1","
"
"1"," 1st Qu.: 3233  "
"1"," Class :character  "
"1"," 1st Qu.:27.09  "
"1"," 1st Qu.:0.01250  "
"1","
"
"1"," Median : 6465  "
"1"," Mode  :character  "
"1"," Median :33.73  "
"1"," Median :0.01916  "
"1","
"
"1"," Mean   : 6465  "
"1","                   "
"1"," Mean   :37.40  "
"1"," Mean   :0.02324  "
"1","
"
"1"," 3rd Qu.: 9697  "
"1","                   "
"1"," 3rd Qu.:44.33  "
"1"," 3rd Qu.:0.02832  "
"1","
"
"1"," Max.   :12929  "
"1","                   "
"1"," Max.   :97.89  "
"1"," Max.   :1.45557  "
"1","
"
"1"," NA's   :55     "
"1","                   "
"1"," NA's   :114    "
"1"," NA's   :55       "
"1","
"
"1",""
"1","  ODO.Psat.mn    "
"1","  ODO.Psat.SD     "
"1","  ODO.Ploc.mn    "
"1","  ODO.Ploc.SD     "
"1","
"
"1"," Min.   : 88.40  "
"1"," Min.   :0.00000  "
"1"," Min.   : 89.10  "
"1"," Min.   :0.00000  "
"1","
"
"1"," 1st Qu.: 94.27  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.: 96.63  "
"1"," 1st Qu.:0.00000  "
"1","
"
"1"," Median : 96.36  "
"1"," Median :0.00000  "
"1"," Median : 98.90  "
"1"," Median :0.00000  "
"1","
"
"1"," Mean   : 96.77  "
"1"," Mean   :0.01611  "
"1"," Mean   : 99.12  "
"1"," Mean   :0.01655  "
"1","
"
"1"," 3rd Qu.: 99.28  "
"1"," 3rd Qu.:0.04045  "
"1"," 3rd Qu.:101.90  "
"1"," 3rd Qu.:0.04045  "
"1","
"
"1"," Max.   :106.40  "
"1"," Max.   :0.07862  "
"1"," Max.   :109.30  "
"1"," Max.   :0.08739  "
"1","
"
"1"," NA's   :55      "
"1"," NA's   :55       "
"1"," NA's   :56      "
"1"," NA's   :55       "
"1","
"
"1",""
"1","   ODO.mgL.mn   "
"1","   ODO.mgL.SD     "
"1"," SpCond.uScm.mn "
"1"," SpCond.uScm.SD   "
"1","
"
"1"," Min.   : 8.89  "
"1"," Min.   :0.00000  "
"1"," Min.   :126.6  "
"1"," Min.   :0.00000  "
"1","
"
"1"," 1st Qu.:10.03  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:203.0  "
"1"," 1st Qu.:0.04671  "
"1","
"
"1"," Median :10.46  "
"1"," Median :0.00000  "
"1"," Median :220.3  "
"1"," Median :0.05045  "
"1","
"
"1"," Mean   :10.80  "
"1"," Mean   :0.00190  "
"1"," Mean   :209.8  "
"1"," Mean   :0.05257  "
"1","
"
"1"," 3rd Qu.:11.43  "
"1"," 3rd Qu.:0.00467  "
"1"," 3rd Qu.:229.3  "
"1"," 3rd Qu.:0.05222  "
"1","
"
"1"," Max.   :14.14  "
"1"," Max.   :0.01044  "
"1"," Max.   :251.8  "
"1"," Max.   :0.42916  "
"1","
"
"1"," NA's   :56     "
"1"," NA's   :55       "
"1"," NA's   :61     "
"1"," NA's   :55       "
"1","
"
"1",""
"1"," Turbidity.FNU.mn  "
"1"," Turbidity.FNU.SD   "
"1","   Temp.C.mn     "
"1","
"
"1"," Min.   :-1.85000  "
"1"," Min.   :  0.00405  "
"1"," Min.   :-0.015  "
"1","
"
"1"," 1st Qu.:-1.04364  "
"1"," 1st Qu.:  0.02292  "
"1"," 1st Qu.: 7.890  "
"1","
"
"1"," Median :-0.52091  "
"1"," Median :  0.04228  "
"1"," Median :10.441  "
"1","
"
"1"," Mean   : 0.07139  "
"1"," Mean   :  0.16304  "
"1"," Mean   :10.700  "
"1","
"
"1"," 3rd Qu.: 0.81182  "
"1"," 3rd Qu.:  0.08755  "
"1"," 3rd Qu.:14.341  "
"1","
"
"1"," Max.   :16.44182  "
"1"," Max.   :260.90165  "
"1"," Max.   :18.458  "
"1","
"
"1"," NA's   :276       "
"1"," NA's   :55         "
"1"," NA's   :406     "
"1","
"
"1",""
"1","   Temp.C.SD      "
"1","     pH.mn      "
"1","     pH.SD        "
"1","  Battery.V.mn  "
"1","
"
"1"," Min.   :0.00000  "
"1"," Min.   :7.260  "
"1"," Min.   :0.00000  "
"1"," Min.   :4.675  "
"1","
"
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:7.540  "
"1"," 1st Qu.:0.00000  "
"1"," 1st Qu.:5.357  "
"1","
"
"1"," Median :0.00040  "
"1"," Median :7.600  "
"1"," Median :0.00000  "
"1"," Median :5.551  "
"1","
"
"1"," Mean   :0.00052  "
"1"," Mean   :7.585  "
"1"," Mean   :0.00080  "
"1"," Mean   :5.541  "
"1","
"
"1"," 3rd Qu.:0.00052  "
"1"," 3rd Qu.:7.650  "
"1"," 3rd Qu.:0.00000  "
"1"," 3rd Qu.:5.758  "
"1","
"
"1"," Max.   :0.01811  "
"1"," Max.   :7.800  "
"1"," Max.   :0.00527  "
"1"," Max.   :6.244  "
"1","
"
"1"," NA's   :55       "
"1"," NA's   :1857   "
"1"," NA's   :55       "
"1"," NA's   :55     "
"1","
"
"1",""
"1","  Battery.V.SD    "
"1"," CablePwr.V.mn"
"1"," CablePwr.V.SD"
"1","
"
"1"," Min.   :0.00000  "
"1"," Min.   :0    "
"1"," Min.   :0    "
"1","
"
"1"," 1st Qu.:0.00302  "
"1"," 1st Qu.:0    "
"1"," 1st Qu.:0    "
"1","
"
"1"," Median :0.00467  "
"1"," Median :0    "
"1"," Median :0    "
"1","
"
"1"," Mean   :0.00482  "
"1"," Mean   :0    "
"1"," Mean   :0    "
"1","
"
"1"," 3rd Qu.:0.00522  "
"1"," 3rd Qu.:0    "
"1"," 3rd Qu.:0    "
"1","
"
"1"," Max.   :0.06332  "
"1"," Max.   :0    "
"1"," Max.   :0    "
"1","
"
"1"," NA's   :55       "
"1"," NA's   :55   "
"1"," NA's   :55   "
"1","
"
"1","
"
"0","# Make univariate time series, covert to zoo, then to ts #"
"0","Temp.only <- lapply(EXO.cl, '[', (c(""datetimeAK"", ""Temp.C.mn"")))"
"0",""
"0","Temp.ts <- lapply(Temp.only, function(x) {read.zoo(x, index.column=1, format=""%Y-%m-%d %H:%M:%S"", tz=""America/Anchorage"")"
"0","})"
"0",""
"0","Temp.xts <- lapply(Temp.ts, function(x) {as.xts(x)"
"0","})"
"0",""
"0",""
"0","# Apply auto.arima (default model in call to na_kalman) and kalman filter (default = smooth) to impute missing values using na.kalman from imputeTS #"
"0","# type = ""level"" added to circumvent error with optim (""need finite values of 'fn'"")"
"0","Temp.int <- lapply(Temp.xts, function(x) {na_kalman(x)"
"0","})"
"0",""
"0","anyNA(Temp.int, recursive = TRUE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","# revert xts to dataframe"
"0","Temp.int = lapply(Temp.int, function(x) {data.frame(datetimeAK=time(x), Temp.C.int=as.matrix(x))"
"0","})"
"0",""
"0","Temp.int <- lapply(Temp.int, setNames, c(""datetimeAK"", ""Temp.C.int""))"
"0",""
"0","# Rejoin to instrument record (EXO.cl)"
"0","EXO.cl.int <- map2(EXO.cl.int, Temp.int, ~merge(.x, .y, by = ""datetimeAK""))"
"0",""
"0","## Compare instrument record and with imputed turbidity time series"
"0","# to dataframe for compatibility with ggplot"
"0","EXO.cl.int.df <- bind_rows(EXO.cl.int, .id = ""Site"")"
"0",""
"0","Temp.int.pl <- EXO.cl.int.df %>% "
"0","  ggplot(aes(x = datetimeAK, y = Temp.C.mn)) +"
"0","  geom_point(color = ""blue"") +"
"0","  #geom_line(color = ""blue"") +"
"0","  geom_line(aes(x = datetimeAK, y = Temp.C.int), color = ""green"") +"
"0","  xlim(as.POSIXct(c(""2021-05-01"", ""2021-10-27""))) +"
"0","  facet_wrap(~Site)"
"0",""
"0","Temp.int.pl"
"2","Warning:"
"2"," Removed 406 rows containing missing values (geom_point).
"
