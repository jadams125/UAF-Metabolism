"0",""
"0",""
"0",""
"0","# Discharge and Depth"
"0","dischargeSalcha <- read.csv(""Metabolism-UAF/dischargeSalchaTXT.csv"")"
"0",""
"0",""
"0","dischargeSalcha <- dischargeSalcha[-c(1), ]"
"0",""
"0","dischargeSalcha$datetimeAK <- as.POSIXct(mdy_hm(dischargeSalcha$datetime))"
"0",""
"0","dischargeSalcha$datetimeAK <- force_tz(dischargeSalcha$datetimeAK, ""America/Anchorage"")"
"0",""
"0","dischargeSalcha <- dischargeSalcha %>% rename(depth = X1761_00065)"
"0","dischargeSalcha <- dischargeSalcha %>% rename(discharge = X1760_00060)"
"0",""
"0","dischargeSalcha <- dischargeSalcha %>% select(discharge, depth, datetimeAK)"
"0",""
"0","# convert to Meters "
"0",""
"0","dischargeSalcha$depth <- as.numeric(dischargeSalcha$depth) * 0.3048"
"0","dischargeSalcha$discharge <- as.numeric(dischargeSalcha$discharge) * 0.0283168"
"0",""
"0",""
"0","dischargeSalcha <- full_join(ts_2021, dischargeSalcha, by = ""datetimeAK"")"
"0",""
"0","write.csv(dischargeSalcha, (""C:/Users/jacob/OneDrive - University of Alaska/GitHub/Metabolism-UAF/q_data.csv""))"
"0",""
"0",""
"0",""
"0","setwd(""C:/Users/jacob/OneDrive - University of Alaska/GitHub/"")"
"0",""
"0","Q.list <- list.files(path=""Metabolism-UAF"", "
"0","                         recursive=F, "
"0","                         pattern=""q_data.csv"", "
"0","                         full.names=TRUE)"
"0",""
"0","Q.cl <- lapply(Q.list, "
"0","                   read.csv, "
"0","                   stringsAsFactors=FALSE, "
"0","                   header = TRUE)"
"0",""
"0",""
"0","# Format datetime"
"0","Q.cl <- lapply(Q.cl, function(x) {"
"0","  mutate(x, datetimeAK = as.POSIXct(datetimeAK, format = ""%Y-%m-%d %H:%M:%S"", tz= ""America/Anchorage""))"
"0","})"
"0",""
"0",""
"0","### Fill gaps in Light ###"
"0","anyNA(Q.cl, recursive = TRUE)"
"1","[1]"
"1"," TRUE"
"1","
"
"0","lapply(Q.cl, summary)"
"1","[[1]]
"
"1",""
"1","      X.1       "
"1","       X        "
"1","   datetimeAK                 "
"1","
"
"1"," Min.   :    1  "
"1"," Min.   :    1  "
"1"," Min.   :2021-05-18 00:00:00  "
"1","
"
"1"," 1st Qu.: 3265  "
"1"," 1st Qu.: 3244  "
"1"," 1st Qu.:2021-06-20 23:56:15  "
"1","
"
"1"," Median : 6528  "
"1"," Median : 6486  "
"1"," Median :2021-07-24 23:52:30  "
"1","
"
"1"," Mean   : 6528  "
"1"," Mean   : 6486  "
"1"," Mean   :2021-07-24 23:52:30  "
"1","
"
"1"," 3rd Qu.: 9792  "
"1"," 3rd Qu.: 9728  "
"1"," 3rd Qu.:2021-08-27 23:48:45  "
"1","
"
"1"," Max.   :13056  "
"1"," Max.   :12971  "
"1"," Max.   :2021-09-30 23:45:00  "
"1","
"
"1","                "
"1"," NA's   :85     "
"1","                              "
"1","
"
"1",""
"1","   discharge     "
"1","     depth      "
"1","
"
"1"," Min.   : 29.17  "
"1"," Min.   :1.996  "
"1","
"
"1"," 1st Qu.: 38.23  "
"1"," 1st Qu.:2.094  "
"1","
"
"1"," Median : 58.05  "
"1"," Median :2.268  "
"1","
"
"1"," Mean   : 62.98  "
"1"," Mean   :2.288  "
"1","
"
"1"," 3rd Qu.: 80.70  "
"1"," 3rd Qu.:2.438  "
"1","
"
"1"," Max.   :154.89  "
"1"," Max.   :2.880  "
"1","
"
"1"," NA's   :193     "
"1"," NA's   :78     "
"1","
"
"1","
"
"0","# Make univariate time series, covert to zoo, then to ts #"
"0","Q.only <- lapply(Q.cl, '[', (c(""datetimeAK"", ""discharge"")))"
"0",""
"0","Q.ts <- lapply(Q.only, function(x) {read.zoo(x, index.column=1, format=""%Y-%m-%d %H:%M:%S"", tz=""America/Anchorage"")"
"0","})"
"0",""
"0","Q.xts <- lapply(Q.ts, function(x) {as.xts(x)"
"0","})"
"0",""
"0","# Apply auto.arima (default model in call to na_kalman) and kalman filter (default = smooth) to impute missing values using na.kalman from imputeTS #"
"0","Q.int <- lapply(Q.xts, function(x) {na_kalman(x, type = ""level"")"
"0","})"
"0",""
"0","anyNA(Q.int, recursive = TRUE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","# revert xts to dataframe"
"0","Q.ma.int = lapply(Q.int, function(x) {data.frame(datetimeAK=time(x), turb.ma.int=as.matrix(x))"
"0","})"
"0",""
"0","Q.ma.int <- lapply(Q.ma.int, setNames, c(""datetimeAK"", ""Q.int""))"
"0",""
"0",""
"0","# Rejoin to instrument record (EXO.cl)"
"0","EXO.cl.int <- map2(EXO.cl.int, Q.ma.int, ~merge(.x, .y, by = ""datetimeAK""))"
"0",""
"0","## Compare instrument record and with imputed turbidity time series"
"0","# to dataframe for compatibility with ggplot"
"0","EXO.cl.int.df <- bind_rows(EXO.cl.int, .id = ""Site"")"
"0",""
"0",""
"0","Q.int.pl <- EXO.cl.int.df %>% "
"0","  ggplot(aes(x = datetimeAK, y = Q.int)) +"
"0","  geom_line(color = ""blue"") +"
"0","  #geom_line(color = ""blue"") +"
"0","  # geom_line(aes(x = datetimeAK, y = ParWm2.int), color = ""green"") +"
"0","  # xlim(as.POSIXct(c(""2021-05-01"", ""2021-10-27""))) +"
"0","  facet_wrap(~Site)"
"0",""
"0","Q.int.pl"
